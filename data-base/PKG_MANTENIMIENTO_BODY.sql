--PKG_MANTENIMIENTO BODY
  PROCEDURE USP_SEL_CRI_CAS_COMPONENTE(
    PI_ID_CRITERIO NUMBER,
    PI_ID_CASO NUMBER,
    PO_REF OUT SYS_REFCURSOR
  )AS
  BEGIN
    OPEN PO_REF FOR
    SELECT  *
    FROM    T_GENM_COMPONENTE
    WHERE   ID_CRITERIO = PI_ID_CRITERIO AND ID_CASO = PI_ID_CASO AND FLAG_ESTADO = '1';            
  END USP_SEL_CRI_CAS_COMPONENTE;
  
  PROCEDURE USP_SEL_INDICADOR(
    PI_ID_CRITERIO NUMBER,
    PI_ID_CASO NUMBER,
    PI_ID_COMPONENTE NUMBER,
    PO_REF OUT SYS_REFCURSOR
  )AS
  BEGIN
    OPEN PO_REF FOR
    SELECT  *
    FROM    T_MAEM_INDICADOR
    WHERE   ID_CRITERIO = PI_ID_CRITERIO AND ID_CASO = PI_ID_CASO AND ID_COMPONENTE = PI_ID_COMPONENTE AND FLAG_ESTADO = '1';            
  END USP_SEL_INDICADOR;
  
  PROCEDURE USP_SEL_GET_PARAMETRO(
    PI_ID_PARAMETRO NUMBER,
    PO_REF OUT SYS_REFCURSOR
  )AS
  BEGIN
    OPEN PO_REF FOR
    SELECT  *
    FROM    T_MAEM_PARAMETRO
    WHERE   ID_PARAMETRO = PI_ID_PARAMETRO;         
  END USP_SEL_GET_PARAMETRO;
  
  PROCEDURE USP_SEL_INDICADOR_ID(
    PI_ID_CRITERIO NUMBER,
    PI_ID_CASO NUMBER,
    PI_ID_COMPONENTE NUMBER,
    --PI_ID_PARAMETRO NUMBER,
    PO_REF OUT SYS_REFCURSOR
  )AS
  BEGIN
    OPEN PO_REF FOR
    SELECT  DISTINCT ID_CRITERIO, ID_CASO, ID_COMPONENTE, ID_INDICADOR
    FROM    T_MAEM_INDICADOR_FORM
    WHERE   ID_CRITERIO = PI_ID_CRITERIO AND ID_CASO = PI_ID_CASO AND ID_COMPONENTE = PI_ID_COMPONENTE /*AND ID_PARAMETRO = PI_ID_PARAMETRO*/ AND FLAG_ESTADO = '1';            
  END USP_SEL_INDICADOR_ID;
  
  PROCEDURE USP_SEL_INDICADOR_FORM(
    PI_ID_CRITERIO NUMBER,
    PI_ID_CASO NUMBER,
    PI_ID_COMPONENTE NUMBER,
    PI_ID_INDICADOR NUMBER,
    PO_REF OUT SYS_REFCURSOR
  )AS
  BEGIN
    OPEN PO_REF FOR
    SELECT  IND.ID_CRITERIO, IND.ID_CASO, IND.ID_COMPONENTE, IND.ID_PARAMETRO, IND.ID_INDICADOR, IND.VALOR,
            P.ID_TIPO_DATO, P.DECIMAL_V, P.VERIFICABLE, P.EDITABLE, P.OBTENIBLE, P.ESTATICO
    FROM    T_MAEM_INDICADOR_FORM IND
    INNER JOIN T_MAEM_PARAMETRO P ON IND.ID_PARAMETRO = P.ID_PARAMETRO
    WHERE   IND.ID_CRITERIO = PI_ID_CRITERIO AND IND.ID_CASO = PI_ID_CASO AND IND.ID_COMPONENTE = PI_ID_COMPONENTE AND IND.ID_INDICADOR = PI_ID_INDICADOR AND IND.FLAG_ESTADO = '1';            
  END USP_SEL_INDICADOR_FORM;
  
  PROCEDURE USP_SEL_INDICADOR_DATA(
    PI_ID_CRITERIO NUMBER,
    PI_ID_CASO NUMBER,
    PI_ID_COMPONENTE NUMBER,
    PI_ID_INDICADOR NUMBER,
    PI_ID_INSCRIPCION NUMBER,
    PO_REF OUT SYS_REFCURSOR
  )AS
  BEGIN
    OPEN PO_REF FOR
    SELECT  IND.ID_CRITERIO, IND.ID_CASO, IND.ID_COMPONENTE, IND.ID_PARAMETRO, IND.ID_INDICADOR, IND.VALOR,
            P.ID_TIPO_DATO, P.DECIMAL_V, P.VERIFICABLE, P.EDITABLE, P.OBTENIBLE, P.ESTATICO
    FROM    T_MAEM_INDICADOR_DATA IND
    INNER JOIN T_MAEM_PARAMETRO P ON IND.ID_PARAMETRO = P.ID_PARAMETRO
    WHERE   IND.ID_CRITERIO = PI_ID_CRITERIO 
            AND IND.ID_CASO = PI_ID_CASO 
            AND IND.ID_COMPONENTE = PI_ID_COMPONENTE 
            AND IND.ID_INDICADOR = PI_ID_INDICADOR
            AND IND.ID_INSCRIPCION = PI_ID_INSCRIPCION
            AND IND.FLAG_ESTADO = '1';            
  END USP_SEL_INDICADOR_DATA;
  
  PROCEDURE USP_PRC_MAN_INDICADOR_DATA(
    PI_ID_CRITERIO NUMBER,
    PI_ID_CASO NUMBER,
    PI_ID_COMPONENTE NUMBER,
    PI_ID_INDICADOR NUMBER,
    PI_ID_PARAMETRO NUMBER,
    PI_ID_INSCRIPCION NUMBER,
    PI_VALOR VARCHAR2,
    PI_USUARIO_GUARDAR NUMBER,
    PO_ROWAFFECTED OUT NUMBER
  )IS
        vCONT NUMBER;
  BEGIN
    SELECT COUNT(*) INTO vCONT 
    FROM T_MAEM_INDICADOR_DATA
    WHERE ID_CRITERIO = PI_ID_CRITERIO 
          AND ID_CASO = PI_ID_CASO
          AND ID_COMPONENTE = PI_ID_COMPONENTE
          AND ID_INDICADOR = PI_ID_INDICADOR
          AND ID_PARAMETRO = PI_ID_PARAMETRO
          AND ID_INSCRIPCION = PI_ID_INSCRIPCION;
          
    IF vCONT = 0 THEN 
      INSERT INTO T_MAEM_INDICADOR_DATA (ID_CRITERIO, ID_CASO, ID_COMPONENTE, ID_INDICADOR, ID_PARAMETRO, ID_INSCRIPCION, VALOR, REG_USUARIO, REG_FECHA)
      VALUES (PI_ID_CRITERIO, PI_ID_CASO, PI_ID_COMPONENTE, PI_ID_INDICADOR, PI_ID_PARAMETRO, PI_ID_INSCRIPCION, PI_VALOR, PI_USUARIO_GUARDAR, SYSDATE);
    ELSE
      UPDATE T_MAEM_INDICADOR_DATA
      SET    VALOR = PI_VALOR,
             UPD_USUARIO = PI_USUARIO_GUARDAR,
             UPD_FECHA = SYSDATE
      WHERE  ID_CRITERIO = PI_ID_CRITERIO 
             AND ID_CASO = PI_ID_CASO
             AND ID_COMPONENTE = PI_ID_COMPONENTE
             AND ID_INDICADOR = PI_ID_INDICADOR
             AND ID_PARAMETRO = PI_ID_PARAMETRO
             AND ID_INSCRIPCION = PI_ID_INSCRIPCION; 
    END IF;
    PO_ROWAFFECTED := SQL%ROWCOUNT;      
  END USP_PRC_MAN_INDICADOR_DATA;
  
  PROCEDURE USP_SEL_NEXT_ID_INDICADOR(
    PI_ID_CRITERIO NUMBER,
    PI_ID_CASO NUMBER,
    PI_ID_COMPONENTE NUMBER,    
    PI_ID_INSCRIPCION NUMBER,
    PO_ID_INDICADOR OUT NUMBER
  )AS
  BEGIN
      SELECT  (NVL(MAX(ID_INDICADOR),0) + 1) INTO PO_ID_INDICADOR
      FROM    T_MAEM_INDICADOR_DATA
      WHERE ID_CRITERIO = PI_ID_CRITERIO
          AND ID_CASO = PI_ID_CASO
          AND ID_COMPONENTE = PI_ID_COMPONENTE
          AND ID_INSCRIPCION = PI_ID_INSCRIPCION;
  END USP_SEL_NEXT_ID_INDICADOR;
  
  PROCEDURE USP_SEL_VERIFICAR_INDICADOR(
    PI_ID_CRITERIO NUMBER,
    PI_ID_CASO NUMBER,
    PI_ID_COMPONENTE NUMBER,    
    PI_ID_INSCRIPCION NUMBER,
    PO_ROW OUT NUMBER
  )AS
  BEGIN
      SELECT  COUNT(*) INTO PO_ROW
      FROM    T_MAEM_INDICADOR_DATA
      WHERE ID_CRITERIO = PI_ID_CRITERIO
          AND ID_CASO = PI_ID_CASO
          AND ID_COMPONENTE = PI_ID_COMPONENTE
          AND ID_INSCRIPCION = PI_ID_INSCRIPCION;
  END USP_SEL_VERIFICAR_INDICADOR;