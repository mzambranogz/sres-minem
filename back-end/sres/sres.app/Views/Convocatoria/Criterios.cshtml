@using sres.be
@using sres.ut
@{
    ViewBag.Titulo = "Criterios";
    ViewBag.SRESDescription = false;
    ConvocatoriaBE convocatoria = (ConvocatoriaBE)ViewData["convocatoria"];
    InscripcionBE inscripcion = (InscripcionBE)ViewData["inscripcion"];
    List<CriterioBE> listaCriterio = (List<CriterioBE>)ViewData["listaCriterio"];
    ConvocatoriaEtapaInscripcionBE convetainsc = (ConvocatoriaEtapaInscripcionBE)ViewData["convetainsc"];
    MigrarEmisionesBE migrar = (MigrarEmisionesBE)ViewData["migrar"];
    decimal total_criterio = listaCriterio.Count();
    decimal ingresados = 0;
    foreach (var cri in listaCriterio) { if (cri.INGRESO_DATOS > 0) { ingresados++; } }
    decimal porcentaje_avance = Decimal.Round(ingresados * 100 / total_criterio);
    string pathFormat = AppSettings.Get<string>("Path.Criterio");
    string criteriosdescripcion = AppSettings.Get<string>("Criterios.Descripcion");
}

@section scripts_footer{
    <script src="@Url.Content("~/Assets/js/plugins/alert.js")"></script>
    <script src="@Url.Content("~/Assets/js/pages/convocatoria_criterioS.js")"></script>
}

<div class="container-fluid mt-5">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <nav class="estilo-05" aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a class="text-sres-gris" href="@Url.Action("Index","Inicio")">Inicio</a></li>
                        <li class="breadcrumb-item"><a class="text-sres-gris" href="@Url.Action("Index","Convocatoria")">Bandeja</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Criterios</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>
</div>
<div class="container-fluid my-3">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="bg-sres-claro p-3">
                    <div class="row">
                        <div class="col-lg-1 col-md-12 text-left text-lg-center">
                            <div class="estilo-07 estilo-02-force text-sres-oscuro d-inline-block d-lg-block">@convocatoria.FECHA_INICIO.ToString("dd")</div>
                            <div class="estilo-03 estilo-02-force text-sres-oscuro d-inline-block d-lg-block">@convocatoria.FECHA_INICIO.ToString("MMM").Replace(".", "").ToUpper()</div>
                            <div class="estilo-02 estilo-02-force text-sres-claro d-inline-block d-lg-block">@convocatoria.FECHA_INICIO.ToString("yyyy")</div>
                        </div>
                        <div class="col-lg-11 col-md-12 barra-oscura">
                            <h2 class="estilo-03 text-sres-oscuro text-limit-1">@convocatoria.NOMBRE</h2>
                            <p class="estilo-01 text-justify text-sres-gris m-0 text-limit-3" data-limit="1">@convocatoria.DESCRIPCION</p>
                            @if (convocatoria.DESCRIPCION.Length > 407)
                            { <div class="text-right d-none d-lg-block"><a class="estilo-01 text-sres-verde leer-mas" href="#">Leer más</a></div> }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@if (convetainsc != null)
{
    if (convetainsc.REALIZADO == "1")
    {
        <div class="container-fluid mt-5">
            <div class="container">
                <div class="row">
                    <div class="offset-lg-1 col-12">
                        <h1>¡LOS CRITERIOS SE ENVIARON A REVISIÓN!</h1>
                    </div>                    
                </div>
                <div class="row">
                    <div class="col-12">
                        <div class="rayado my-5 wow fadeIn"></div>
                    </div>
                </div>
                <div class="row">
                    <div class="offset-lg-9 col-lg-3 col-md-12 col-sm-12 my-3"><a class="btn btn-secondary text-white w-100 mb-3" href="@Url.Action("Index","Convocatoria")">Regresar</a></div>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="container-fluid mb-3">
        <div class="container">
            <div class="rayado wow fadeIn"></div>
        </div>
    </div>
    <div class="container-fluid mb-5">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <p class="estilo-02 text-justify text-sres-azul m-0">Ingrese y complete todos los criterios de evaluación</p>
                    <p class="estilo-01 text-justify text-sres-gris m-0">@criteriosdescripcion</p>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="container">
            <div class="row">
                <div class="col-12" data-toggle="tooltip" data-placement="top" title="1 de 8 criterios registrados">
                    <div class="progress" style="height: 25px;">
                        <div class="progress-bar estilo-01 bg-degradado text-limit-1" role="progressbar" aria-valuenow="12.5" aria-valuemin="0" aria-valuemax="100" style="width: @porcentaje_avance%">@ingresados de @total_criterio Criterios registrados</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid my-5">
        <div class="container">
            <div class="row">
                @if (listaCriterio != null)
                {
                    if (listaCriterio.Count > 0)
                    {
                        int index = 0;
                        string bg = "";
                        string linea = "";
                        string icono = "";
                        string pathDirectoryRelative = "";
                        foreach (CriterioBE item in listaCriterio)
                        {
                            index++;
                            <div class="col-lg-3 col-md-6 col-sm-12 text-center my-3">
                                @{bg = item.INGRESO_DATOS == 0 ? "bg-sres-claro" : "bg-sres-verde-claro";
                                    linea = item.INGRESO_DATOS == 0 ? "border-linea" : "border-linea-verde";
                                    icono = item.INGRESO_DATOS == 0 ? "" : "<i class='fas fa-check-circle text-sres-verde indicador'></i>";
                                    pathDirectoryRelative = string.Format(pathFormat, item.ID_CRITERIO);
                                }

                                @Html.Raw(icono)
                                <a class="d-block @bg @linea rounded h-100 p-3" href="@Url.Content($"~/Convocatoria/{convocatoria.ID_CONVOCATORIA}/Criterio/{item.ID_CRITERIO}")">
                                    <img class="img-fluid" src="@Url.Content($"~/{pathDirectoryRelative}/{item.ARCHIVO_BASE}")">
                                    <div class="estilo-01 text-sres-azul pt-3">@item.NOMBRE</div>
                                </a>
                            </div>
                        }
                     }
                 }
            </div>
            @if (convocatoria.ID_ETAPA == 6)
            {
                <div class="row">
                    <div class="col-lg-3 col-md-12 col-sm-12"><span data-toggle="modal" data-target="#iniciativa-medida-ndc"><a class="btn btn-warning text-white w-100 mb-3" href="javascript:void(0)" id="migrar-emisiones">Migrar Emisiones tCO<sub>2</sub></a></span></div>
                </div>
            }   
            <div class="row">
                <div class="col-12">
                    <div class="rayado my-5 wow fadeIn"></div>
                </div>
            </div>
            <div class="row">
                <div class="offset-lg-6 col-lg-3 col-md-12 col-sm-12 my-3"><a class="btn btn-secondary text-white w-100 mb-3" href="@Url.Action("Index","Convocatoria")">Regresar</a></div>
                <div class="col-lg-3 col-md-12 col-sm-12 my-3"><a class="btn btn-primary text-white w-100 mb-3" href="javascript:void(0)" id="btnGuardar">Finalizar</a></div>
            </div>
            <div class="row">
                <div class="col-12 alert-add">
                </div>
            </div>
        </div>
    </div>
    }

}
else
{
    <div class="container-fluid mb-3">
        <div class="container">
            <div class="rayado wow fadeIn"></div>
        </div>
    </div>
    <div class="container-fluid mb-5">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <p class="estilo-02 text-justify text-sres-azul m-0">Ingrese y complete todos los criterios de evaluación</p>
                    <p class="estilo-01 text-justify text-sres-gris m-0">@criteriosdescripcion</p>                    
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="container">
            <div class="row">
                <div class="col-12" data-toggle="tooltip" data-placement="top" title="1 de 8 criterios registrados">
                    <div class="progress" style="height: 25px;">
                        <div class="progress-bar estilo-01 bg-degradado text-limit-1" role="progressbar" aria-valuenow="12.5" aria-valuemin="0" aria-valuemax="100" style="width: @porcentaje_avance%">@ingresados de @total_criterio Criterios registrados</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid my-5">
        <div class="container">
            <div class="row">
                @if (listaCriterio != null)
                {
                    if (listaCriterio.Count > 0)
                    {
                        int index = 0;
                        string bg = "";
                        string linea = "";
                        string icono = "";
                        string pathDirectoryRelative = "";
                        foreach (CriterioBE item in listaCriterio)
                        {
                            index++;
                            <div class="col-lg-3 col-md-6 col-sm-12 text-center my-3">
                                @{bg = item.INGRESO_DATOS == 0 ? "bg-sres-claro" : "bg-sres-verde-claro";
                                    linea = item.INGRESO_DATOS == 0 ? "border-linea" : "border-linea-verde";
                                    icono = item.INGRESO_DATOS == 0 ? "" : "<i class='fas fa-check-circle text-sres-verde indicador'></i>";
                                    pathDirectoryRelative = string.Format(pathFormat, item.ID_CRITERIO);
                                }

                                @Html.Raw(icono)
                                <a class="d-block @bg @linea rounded h-100 p-3" href="@Url.Content($"~/Convocatoria/{convocatoria.ID_CONVOCATORIA}/Criterio/{item.ID_CRITERIO}")">
                                    <img class="img-fluid" src="@Url.Content($"~/{pathDirectoryRelative}/{item.ARCHIVO_BASE}")">
                                    <div class="estilo-01 text-sres-azul pt-3">@item.NOMBRE</div>
                                </a>
                            </div>
                        }
                     }
                 }
            </div>
            @if (convocatoria.ID_ETAPA == 6)
            {
                <div class="row">
                    <div class="col-lg-3 col-md-12 col-sm-12"><span data-toggle="modal" data-target="#iniciativa-medida-ndc"><a class="btn btn-warning text-white w-100 mb-3" href="javascript:void(0)" id="migrar-emisiones">Migrar Emisiones tCO<sub>2</sub></a></span></div>
                </div>
            }            
            <div class="row">
                <div class="col-12">
                    <div class="rayado my-5 wow fadeIn"></div>
                </div>
            </div>
            <div class="row">
                <div class="offset-lg-6 col-lg-3 col-md-12 col-sm-12 my-3"><a class="btn btn-secondary text-white w-100 mb-3" href="@Url.Action("Index","Convocatoria")">Regresar</a></div>
                <div class="col-lg-3 col-md-12 col-sm-12 my-3"><a class="btn btn-primary text-white w-100 mb-3" href="javascript:void(0)" id="btnGuardar">Finalizar</a></div>
            </div>
            <div class="row">
                <div class="col-12 alert-add">
                </div>
            </div>
        </div>
    </div>
}

<div class="modal fade" id="iniciativa-medida-ndc" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content">
            @*<div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Seleccione la iniciativa <br><small class="text-muted">con la que participará por el reconocimiento para las medidas mitigación NDC</small></h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>*@
            <div class="modal-body medidas-modal">
                <div class="col-sm-12 col-md-12 col-lg-12">
                    <h3 class="text-center">Seleccione la(s) iniciativa(s)</h3>
                    <p class="text-center">con la que participará para el reconocimiento de las medidas de mitigación NDC</p>
                </div>
                <div class="row">
                    <div class="col-12">
                        <table class="table" id="tabla-migrar">
                            <thead>
                                <tr>
                                    <th>Seleccionar</th>
                                    <th>Cod. Iniciativa</th>
                                    <th>Iniciativa</th>
                                    <th>Medida mitigación</th>
                                    <th>Emisiones Reducidas (tCO<sub>2</sub>)</th>
                                </tr>
                            </thead>
                            <tbody>

                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer justify-content-center" id="pieRecordatorio">
                    <a class="btn btn-primary" href="#" id="btn-migrar">Si, migrar</a>
                    <button class="btn btn-dark" type="button" data-dismiss="modal">Cancelar</button>
                </div>
                <div class="alert-emisones-add"></div>
            </div>
        </div>
    </div>
</div>


<script>
    const idConvocatoria = @convocatoria.ID_CONVOCATORIA;
    const idEtapa = @convocatoria.ID_ETAPA;
    const idInscripcion = @inscripcion.ID_INSCRIPCION;
    const ingresadosCri = @ingresados;
    const totalCri = @total_criterio;
    const idIniciativas = '@migrar.INICIATIVAS';
</script>